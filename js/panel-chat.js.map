{"version":3,"sources":["../src/panel-chat.tsx"],"names":["ChatRoom","options","classType","users","userCount","canConnect","pmTarget","challengeMenuOpen","challengingFormat","challengedFormat","updateTarget","connect","connected","PS","send","id","connectWhenLoggedIn","force","startsWith","slice","split","id1","id2","user","userid","toID","setUsers","title","handleMessage","line","spaceIndex","indexOf","cmd","target","roomid","test","join","leave","openChallenge","cancelChallenge","update","receiveLine","direct","count","usernames","username","addUser","removeUser","noUpdate","renameUser","oldUsername","destroy","PSRoom","ChatTextEntry","subscription","textbox","history","historyIndex","style","height","newHeight","Math","min","max","scrollHeight","focusIfNoSelection","e","tagName","selection","window","getSelection","type","elem","base","children","focus","keyDown","handleKey","props","onKey","preventDefault","stopImmediatePropagation","componentDidMount","subscribe","forceUpdate","componentWillUnmount","unsubscribe","submit","onMessage","value","historyPush","historyUp","historyDown","length","duplicateIndex","lastIndexOf","splice","push","cmdKey","metaKey","ctrlKey","altKey","shiftKey","keyCode","toggleFormatChar","formatChar","setSelectionRange","start","selectionStart","end","selectionEnd","charAt","wrap","substr","nesting","render","left","color","BattleLog","usernameColor","name","room","resize","width","padding","focusPreview","preact","Component","ChatPanel","text","chatLog","getElementsByClassName","scrollTop","offsetHeight","makeChallenge","format","team","packedTeam","Error","acceptChallenge","querySelector","tinyLayout","challengeTo","challengeFrom","PSRoomPanel","ChatUserList","state","expanded","toggleExpanded","setState","msg","userList","Object","entries","PSUtils","sortBy","server","getGroup","order","endsWith","minimized","map","groupSymbol","group","groups","includes","ChatLog","log","noSubscription","tokens","parseInt","shift","add","setControlsJSX","shouldComponentUpdate","className","top","updateScroll","jsx","controlsElem","undefined","battle","scene","onClick","roomTypes","Model","updateRoomTypes"],"mappings":"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","sourcesContent":["/**\r\n * Chat panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nclass ChatRoom extends PSRoom {\r\n\treadonly classType: 'chat' | 'battle' = 'chat';\r\n\tusers: {[userid: string]: string} = {};\r\n\tuserCount = 0;\r\n\treadonly canConnect = true;\r\n\r\n\t// PM-only properties\r\n\tpmTarget: string | null = null;\r\n\tchallengeMenuOpen = false;\r\n\tchallengingFormat: string | null = null;\r\n\tchallengedFormat: string | null = null;\r\n\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tif (options.pmTarget) this.pmTarget = options.pmTarget as string;\r\n\t\tif (options.challengeMenuOpen) this.challengeMenuOpen = true;\r\n\t\tthis.updateTarget(true);\r\n\t\tthis.connect();\r\n\t}\r\n\tconnect() {\r\n\t\tif (!this.connected) {\r\n\t\t\tif (!this.pmTarget) PS.send(`|/join ${this.id}`);\r\n\t\t\tthis.connected = true;\r\n\t\t\tthis.connectWhenLoggedIn = false;\r\n\t\t}\r\n\t}\r\n\tupdateTarget(force?: boolean) {\r\n\t\tif (this.id.startsWith('pm-')) {\r\n\t\t\tconst [id1, id2] = this.id.slice(3).split('-');\r\n\t\t\tif (id1 === PS.user.userid && toID(this.pmTarget) !== id2) {\r\n\t\t\t\tthis.pmTarget = id2;\r\n\t\t\t} else if (id2 === PS.user.userid && toID(this.pmTarget) !== id1) {\r\n\t\t\t\tthis.pmTarget = id1;\r\n\t\t\t} else if (!force) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tthis.pmTarget = id1;\r\n\t\t\t}\r\n\t\t\tif (!this.userCount) {\r\n\t\t\t\tthis.setUsers(2, [` ${id1}`, ` ${id2}`]);\r\n\t\t\t}\r\n\t\t\tthis.title = `[PM] ${this.pmTarget}`;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @return true to prevent line from being sent to server\r\n\t */\r\n\thandleMessage(line: string) {\r\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\r\n\t\tconst spaceIndex = line.indexOf(' ');\r\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\r\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\r\n\t\tswitch (cmd) {\r\n\t\tcase 'j': case 'join': {\r\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\r\n\t\t\tPS.join(roomid);\r\n\t\t\treturn true;\r\n\t\t} case 'part': case 'leave': {\r\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\r\n\t\t\tPS.leave(roomid || this.id);\r\n\t\t\treturn true;\r\n\t\t} case 'chall': case 'challenge': {\r\n\t\t\tif (target) {\r\n\t\t\t\tPS.join(`challenge-${toID(target)}` as RoomID);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis.openChallenge();\r\n\t\t\treturn true;\r\n\t\t} case 'cchall': case 'cancelchallenge': {\r\n\t\t\tthis.cancelChallenge();\r\n\t\t\treturn true;\r\n\t\t} case 'reject': {\r\n\t\t\tthis.challengedFormat = null;\r\n\t\t\tthis.update(null);\r\n\t\t\treturn false;\r\n\t\t}}\r\n\t\treturn false;\r\n\t}\r\n\topenChallenge() {\r\n\t\tif (!this.pmTarget) {\r\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.challengeMenuOpen = true;\r\n\t\tthis.update(null);\r\n\t}\r\n\tcancelChallenge() {\r\n\t\tif (!this.pmTarget) {\r\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.challengingFormat) {\r\n\t\t\tthis.send('/cancelchallenge', true);\r\n\t\t\tthis.challengingFormat = null;\r\n\t\t\tthis.challengeMenuOpen = true;\r\n\t\t} else {\r\n\t\t\tthis.challengeMenuOpen = false;\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t}\r\n\tsend(line: string, direct?: boolean) {\r\n\t\tthis.updateTarget();\r\n\t\tif (!direct && !line) return;\r\n\t\tif (!direct && this.handleMessage(line)) return;\r\n\t\tif (this.pmTarget) {\r\n\t\t\tPS.send(`|/pm ${this.pmTarget}, ${line}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsuper.send(line, true);\r\n\t}\r\n\tsetUsers(count: number, usernames: string[]) {\r\n\t\tthis.userCount = count;\r\n\t\tthis.users = {};\r\n\t\tfor (const username of usernames) {\r\n\t\t\tconst userid = toID(username);\r\n\t\t\tthis.users[userid] = username;\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t}\r\n\taddUser(username: string) {\r\n\t\tconst userid = toID(username);\r\n\t\tif (!(userid in this.users)) this.userCount++;\r\n\t\tthis.users[userid] = username;\r\n\t\tthis.update(null);\r\n\t}\r\n\tremoveUser(username: string, noUpdate?: boolean) {\r\n\t\tconst userid = toID(username);\r\n\t\tif (userid in this.users) {\r\n\t\t\tthis.userCount--;\r\n\t\t\tdelete this.users[userid];\r\n\t\t}\r\n\t\tif (!noUpdate) this.update(null);\r\n\t}\r\n\trenameUser(username: string, oldUsername: string) {\r\n\t\tthis.removeUser(oldUsername, true);\r\n\t\tthis.addUser(username);\r\n\t\tthis.update(null);\r\n\t}\r\n\tdestroy() {\r\n\t\tif (this.pmTarget) this.connected = false;\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nclass ChatTextEntry extends preact.Component<{\r\n\troom: PSRoom, onMessage: (msg: string) => void, onKey: (e: KeyboardEvent) => boolean,\r\n\tleft?: number,\r\n}> {\r\n\tsubscription: PSSubscription | null = null;\r\n\ttextbox: HTMLTextAreaElement = null!;\r\n\thistory: string[] = [];\r\n\thistoryIndex = 0;\r\n\tcomponentDidMount() {\r\n\t\tthis.subscription = PS.user.subscribe(() => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t});\r\n\t\tthis.textbox = this.base!.children[0].children[1] as HTMLTextAreaElement;\r\n\t\tif (this.base) this.update();\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.subscription) {\r\n\t\t\tthis.subscription.unsubscribe();\r\n\t\t\tthis.subscription = null;\r\n\t\t}\r\n\t}\r\n\tupdate = () => {\r\n\t\tconst textbox = this.textbox;\r\n\t\ttextbox.style.height = `12px`;\r\n\t\tconst newHeight = Math.min(Math.max(textbox.scrollHeight - 2, 16), 600);\r\n\t\ttextbox.style.height = `${newHeight}px`;\r\n\t};\r\n\tfocusIfNoSelection = (e: Event) => {\r\n\t\tif ((e.target as HTMLElement).tagName === 'TEXTAREA') return;\r\n\t\tconst selection = window.getSelection()!;\r\n\t\tif (selection.type === 'Range') return;\r\n\t\tconst elem = this.base!.children[0].children[1] as HTMLTextAreaElement;\r\n\t\telem.focus();\r\n\t};\r\n\tsubmit() {\r\n\t\tthis.props.onMessage(this.textbox.value);\r\n\t\tthis.historyPush(this.textbox.value);\r\n\t\tthis.textbox.value = '';\r\n\t\tthis.update();\r\n\t\treturn true;\r\n\t}\r\n\tkeyDown = (e: KeyboardEvent) => {\r\n\t\tif (this.handleKey(e) || this.props.onKey(e)) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\thistoryUp() {\r\n\t\tif (this.historyIndex === 0) return false;\r\n\t\tconst line = this.textbox.value;\r\n\t\tif (line !== '') this.history[this.historyIndex] = line;\r\n\t\tthis.textbox.value = this.history[--this.historyIndex];\r\n\t\treturn true;\r\n\t}\r\n\thistoryDown() {\r\n\t\tconst line = this.textbox.value;\r\n\t\tif (line !== '') this.history[this.historyIndex] = line;\r\n\t\tif (this.historyIndex === this.history.length) {\r\n\t\t\tif (!line) return false;\r\n\t\t\tthis.textbox.value = '';\r\n\t\t} else if (++this.historyIndex === this.history.length) {\r\n\t\t\tthis.textbox.value = '';\r\n\t\t} else {\r\n\t\t\tthis.textbox.value = this.history[this.historyIndex];\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\thistoryPush(line: string) {\r\n\t\tconst duplicateIndex = this.history.lastIndexOf(line);\r\n\t\tif (duplicateIndex >= 0) this.history.splice(duplicateIndex, 1);\r\n\t\tif (this.history.length > 100) this.history.splice(0, 20);\r\n\t\tthis.history.push(line);\r\n\t\tthis.historyIndex = this.history.length;\r\n\t}\r\n\thandleKey(e: KeyboardEvent) {\r\n\t\tconst cmdKey = ((e.metaKey ? 1 : 0) + (e.ctrlKey ? 1 : 0) === 1) && !e.altKey && !e.shiftKey;\r\n\t\tif (e.keyCode === 13 && !e.shiftKey) { // Enter key\r\n\t\t\treturn this.submit();\r\n\t\t} else if (e.keyCode === 73 && cmdKey) { // Ctrl + I key\r\n\t\t\treturn this.toggleFormatChar('_');\r\n\t\t} else if (e.keyCode === 66 && cmdKey) { // Ctrl + B key\r\n\t\t\treturn this.toggleFormatChar('*');\r\n\t\t} else if (e.keyCode === 192 && cmdKey) { // Ctrl + ` key\r\n\t\t\treturn this.toggleFormatChar('`');\r\n\t\t// } else if (e.keyCode === 9 && !e.ctrlKey) { // Tab key\r\n\t\t// \tconst reverse = !!e.shiftKey; // Shift+Tab reverses direction\r\n\t\t// \treturn this.handleTabComplete(this.$chatbox, reverse);\r\n\t\t} else if (e.keyCode === 38 && !e.shiftKey && !e.altKey) { // Up key\r\n\t\t\treturn this.historyUp();\r\n\t\t} else if (e.keyCode === 40 && !e.shiftKey && !e.altKey) { // Down key\r\n\t\t\treturn this.historyDown();\r\n\t\t// } else if (app.user.lastPM && (textbox.value === '/reply' || textbox.value === '/r' || textbox.value === '/R') && e.keyCode === 32) { // '/reply ' is being written\r\n\t\t// \tvar val = '/pm ' + app.user.lastPM + ', ';\r\n\t\t// \ttextbox.value = val;\r\n\t\t// \ttextbox.setSelectionRange(val.length, val.length);\r\n\t\t// \treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\ttoggleFormatChar(formatChar: string) {\r\n\t\tconst textbox = this.textbox;\r\n\t\tif (!textbox.setSelectionRange) return false;\r\n\r\n\t\tlet value = textbox.value;\r\n\t\tlet start = textbox.selectionStart;\r\n\t\tlet end = textbox.selectionEnd;\r\n\r\n\t\t// make sure start and end aren't midway through the syntax\r\n\t\tif (value.charAt(start) === formatChar && value.charAt(start - 1) === formatChar &&\r\n\t\t\tvalue.charAt(start - 2) !== formatChar) {\r\n\t\t\tstart++;\r\n\t\t}\r\n\t\tif (value.charAt(end) === formatChar && value.charAt(end - 1) === formatChar &&\r\n\t\t\tvalue.charAt(end - 2) !== formatChar) {\r\n\t\t\tend--;\r\n\t\t}\r\n\r\n\t\t// wrap in doubled format char\r\n\t\tconst wrap = formatChar + formatChar;\r\n\t\tvalue = value.substr(0, start) + wrap + value.substr(start, end - start) + wrap + value.substr(end);\r\n\t\tstart += 2;\r\n\t\tend += 2;\r\n\r\n\t\t// prevent nesting\r\n\t\tconst nesting = wrap + wrap;\r\n\t\tif (value.substr(start - 4, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, start - 4) + value.substr(start);\r\n\t\t\tstart -= 4;\r\n\t\t\tend -= 4;\r\n\t\t} else if (start !== end && value.substr(start - 2, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, start - 2) + value.substr(start + 2);\r\n\t\t\tstart -= 2;\r\n\t\t\tend -= 4;\r\n\t\t}\r\n\t\tif (value.substr(end, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, end) + value.substr(end + 4);\r\n\t\t} else if (start !== end && value.substr(end - 2, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, end - 2) + value.substr(end + 2);\r\n\t\t\tend -= 2;\r\n\t\t}\r\n\r\n\t\ttextbox.value = value;\r\n\t\ttextbox.setSelectionRange(start, end);\r\n\t\treturn true;\r\n\t}\r\n\trender() {\r\n\t\treturn <div\r\n\t\t\tclass=\"chat-log-add hasuserlist\" onClick={this.focusIfNoSelection} style={{left: this.props.left || 0}}\r\n\t\t>\r\n\t\t\t<form class=\"chatbox\">\r\n\t\t\t\t<label style={{color: BattleLog.usernameColor(PS.user.userid)}}>{PS.user.name}:</label>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tclass={this.props.room.connected ? 'textbox' : 'textbox disabled'}\r\n\t\t\t\t\tautofocus\r\n\t\t\t\t\trows={1}\r\n\t\t\t\t\tonInput={this.update}\r\n\t\t\t\t\tonKeyDown={this.keyDown}\r\n\t\t\t\t\tstyle={{resize: 'none', width: '100%', height: '16px', padding: '2px 3px 1px 3px'}}\r\n\t\t\t\t\tplaceholder={PS.focusPreview(this.props.room)}\r\n\t\t\t\t/>\r\n\t\t\t</form>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass ChatPanel extends PSRoomPanel<ChatRoom> {\r\n\tsend = (text: string) => {\r\n\t\tthis.props.room.send(text);\r\n\t};\r\n\tfocus() {\r\n\t\tthis.base!.querySelector('textarea')!.focus();\r\n\t}\r\n\tfocusIfNoSelection = () => {\r\n\t\tconst selection = window.getSelection()!;\r\n\t\tif (selection.type === 'Range') return;\r\n\t\tthis.focus();\r\n\t};\r\n\tonKey = (e: KeyboardEvent) => {\r\n\t\tif (e.keyCode === 33) { // Pg Up key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\r\n\t\t\treturn true;\r\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tmakeChallenge = (e: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\r\n\t\tPS.send(`|/utm ${packedTeam}`);\r\n\t\tPS.send(`|/challenge ${room.pmTarget}, ${format}`);\r\n\t\troom.challengeMenuOpen = false;\r\n\t\troom.challengingFormat = format;\r\n\t\troom.update(null);\r\n\t};\r\n\tacceptChallenge = (e: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\r\n\t\tPS.send(`|/utm ${packedTeam}`);\r\n\t\tthis.props.room.send(`/accept`);\r\n\t\troom.challengedFormat = null;\r\n\t\troom.update(null);\r\n\t};\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst tinyLayout = room.width < 450;\r\n\r\n\t\tconst challengeTo = room.challengingFormat ? <div class=\"challenge\">\r\n\t\t\t<TeamForm format={room.challengingFormat} onSubmit={null}>\r\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : room.challengeMenuOpen ? <div class=\"challenge\">\r\n\t\t\t<TeamForm onSubmit={this.makeChallenge}>\r\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Challenge</strong></button> {}\r\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : null;\r\n\r\n\t\tconst challengeFrom = room.challengedFormat ? <div class=\"challenge\">\r\n\t\t\t<TeamForm format={room.challengedFormat} onSubmit={this.acceptChallenge}>\r\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Accept</strong></button> {}\r\n\t\t\t\t<button name=\"cmd\" value=\"/reject\" class=\"button\">Reject</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : null;\r\n\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<div class=\"tournament-wrapper hasuserlist\"></div>\r\n\t\t\t<ChatLog class=\"chat-log\" room={this.props.room} onClick={this.focusIfNoSelection} left={tinyLayout ? 0 : 146}>\r\n\t\t\t\t{challengeTo || challengeFrom && [challengeTo, challengeFrom]}\r\n\t\t\t</ChatLog>\r\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={tinyLayout ? 0 : 146} />\r\n\t\t\t<ChatUserList room={this.props.room} minimized={tinyLayout} />\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass ChatUserList extends preact.Component<{room: ChatRoom, left?: number, minimized?: boolean}> {\r\n\tsubscription: PSSubscription | null = null;\r\n\tstate = {\r\n\t\texpanded: false,\r\n\t};\r\n\ttoggleExpanded = () => {\r\n\t\tthis.setState({expanded: !this.state.expanded});\r\n\t};\r\n\tcomponentDidMount() {\r\n\t\tthis.subscription = this.props.room.subscribe(msg => {\r\n\t\t\tif (!msg) this.forceUpdate();\r\n\t\t});\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.subscription) this.subscription.unsubscribe();\r\n\t}\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tlet userList = Object.entries(room.users) as [ID, string][];\r\n\t\tPSUtils.sortBy(userList, ([id, name]) => (\r\n\t\t\t[PS.server.getGroup(name.charAt(0)).order, !name.endsWith('@!'), id]\r\n\t\t));\r\n\t\treturn <ul class={'userlist' + (this.props.minimized ? (this.state.expanded ? ' userlist-maximized' : ' userlist-minimized') : '')} style={{left: this.props.left || 0}}>\r\n\t\t\t<li class=\"userlist-count\" style=\"text-align:center;padding:2px 0\" onClick={this.toggleExpanded}><small>{room.userCount} users</small></li>\r\n\t\t\t{userList.map(([userid, name]) => {\r\n\t\t\t\tconst groupSymbol = name.charAt(0);\r\n\t\t\t\tconst group = PS.server.groups[groupSymbol] || {type: 'user', order: 0};\r\n\t\t\t\tlet color;\r\n\t\t\t\tif (name.endsWith('@!')) {\r\n\t\t\t\t\tname = name.slice(0, -2);\r\n\t\t\t\t\tcolor = '#888888';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcolor = BattleLog.usernameColor(userid);\r\n\t\t\t\t}\r\n\t\t\t\treturn <li key={userid}><button class=\"userbutton username\" data-name={name}>\r\n\t\t\t\t\t<em class={`group${['leadership', 'staff'].includes(group.type!) ? ' staffgroup' : ''}`}>\r\n\t\t\t\t\t\t{groupSymbol}\r\n\t\t\t\t\t</em>\r\n\t\t\t\t\t{group.type === 'leadership' ?\r\n\t\t\t\t\t\t<strong><em style={{color}}>{name.substr(1)}</em></strong>\r\n\t\t\t\t\t: group.type === 'staff' ?\r\n\t\t\t\t\t\t<strong style={{color}}>{name.substr(1)}</strong>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t\t<span style={{color}}>{name.substr(1)}</span>\r\n\t\t\t\t\t}\r\n\t\t\t\t</button></li>;\r\n\t\t\t})}\r\n\t\t</ul>;\r\n\t}\r\n}\r\n\r\nclass ChatLog extends preact.Component<{\r\n\tclass: string, room: ChatRoom, onClick?: (e: Event) => void, children?: preact.ComponentChildren,\r\n\tleft?: number, top?: number, noSubscription?: boolean;\r\n}> {\r\n\tlog: BattleLog | null = null;\r\n\tsubscription: PSSubscription | null = null;\r\n\tcomponentDidMount() {\r\n\t\tif (!this.props.noSubscription) {\r\n\t\t\tthis.log = new BattleLog(this.base! as HTMLDivElement);\r\n\t\t}\r\n\t\tthis.subscription = this.props.room.subscribe(tokens => {\r\n\t\t\tif (!tokens) return;\r\n\t\t\tswitch (tokens[0]) {\r\n\t\t\tcase 'users':\r\n\t\t\t\tconst usernames = tokens[1].split(',');\r\n\t\t\t\tconst count = parseInt(usernames.shift()!, 10);\r\n\t\t\t\tthis.props.room.setUsers(count, usernames);\r\n\t\t\t\treturn;\r\n\t\t\tcase 'join': case 'j': case 'J':\r\n\t\t\t\tthis.props.room.addUser(tokens[1]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'leave': case 'l': case 'L':\r\n\t\t\t\tthis.props.room.removeUser(tokens[1]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'name': case 'n': case 'N':\r\n\t\t\t\tthis.props.room.renameUser(tokens[1], tokens[2]);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!this.props.noSubscription) this.log!.add(tokens);\r\n\t\t});\r\n\t\tthis.setControlsJSX(this.props.children);\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.subscription) this.subscription.unsubscribe();\r\n\t}\r\n\tshouldComponentUpdate(props: typeof ChatLog.prototype.props) {\r\n\t\tif (props.class !== this.props.class) {\r\n\t\t\tthis.base!.className = props.class;\r\n\t\t}\r\n\t\tif (props.left !== this.props.left) this.base!.style.left = `${props.left || 0}px`;\r\n\t\tif (props.top !== this.props.top) this.base!.style.top = `${props.top || 0}px`;\r\n\t\tthis.setControlsJSX(props.children);\r\n\t\tthis.updateScroll();\r\n\t\treturn false;\r\n\t}\r\n\tsetControlsJSX(jsx: preact.ComponentChildren | undefined) {\r\n\t\tconst children = this.base!.children;\r\n\t\tlet controlsElem = children[children.length - 1] as HTMLDivElement | undefined;\r\n\t\tif (controlsElem && controlsElem.className !== 'controls') controlsElem = undefined;\r\n\t\tif (!jsx) {\r\n\t\t\tif (!controlsElem) return;\r\n\t\t\tpreact.render(null, this.base!, controlsElem);\r\n\t\t\tthis.updateScroll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tpreact.render(<div class=\"controls\">{jsx}</div>, this.base!, controlsElem);\r\n\t\tthis.updateScroll();\r\n\t}\r\n\tupdateScroll() {\r\n\t\tif (this.log) {\r\n\t\t\tthis.log.updateScroll();\r\n\t\t} else if (this.props.room.battle) {\r\n\t\t\tthis.log = (this.props.room.battle as Battle).scene.log;\r\n\t\t\tthis.log.updateScroll();\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\treturn <div class={this.props.class} role=\"log\" onClick={this.props.onClick} style={{\r\n\t\t\tleft: this.props.left || 0, top: this.props.top || 0,\r\n\t\t}}></div>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['chat'] = {\r\n\tModel: ChatRoom,\r\n\tComponent: ChatPanel,\r\n};\r\nPS.updateRoomTypes();\r\n"],"file":"panel-chat.js"}