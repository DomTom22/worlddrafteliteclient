{"version":3,"sources":["../src/panel-teambuilder.tsx"],"names":["TeambuilderRoom","DEFAULT_FORMAT","curFolder","curFolderKeep","handleMessage","line","startsWith","spaceIndex","indexOf","cmd","slice","target","PS","teams","push","createTeam","unshift","update","team","byKey","undelete","alert","copyFrom","name","format","folder","packedTeam","iconCache","key","endsWith","list","length","PSRoom","TeambuilderPanel","selectFolder","e","room","props","elem","className","getAttribute","parentElement","preventDefault","stopImmediatePropagation","forceUpdate","renderFolderList","folderTable","folders","PSUtils","sortBy","parseInt","charAt","renderedFormatFolders","renderedFolders","gen","newGen","folderOpenIcon","render","deletedTeams","undeleteIndex","splice","filterFolder","filterFormat","filter","map","PSRoomPanel","roomTypes","Model","Component","title"],"mappings":"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","sourcesContent":["/**\r\n * Teambuilder panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nclass TeambuilderRoom extends PSRoom {\r\n\treadonly DEFAULT_FORMAT = 'gen8' as ID;\r\n\r\n\t/**\r\n\t * - `\"\"` - all\r\n\t * - `\"gen[NUMBER][ID]\"` - format folder\r\n\t * - `\"gen[NUMBER]\"` - uncategorized gen folder\r\n\t * - `\"[ID]/\"` - folder\r\n\t * - `\"/\"` - not in folder\r\n\t */\r\n\tcurFolder = '';\r\n\tcurFolderKeep = '';\r\n\r\n\t/**\r\n\t * @return true to prevent line from being sent to server\r\n\t */\r\n\thandleMessage(line: string) {\r\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\r\n\t\tconst spaceIndex = line.indexOf(' ');\r\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\r\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\r\n\t\tswitch (cmd) {\r\n\t\tcase 'newteam': {\r\n\t\t\tif (target === 'bottom') {\r\n\t\t\t\tPS.teams.push(this.createTeam());\r\n\t\t\t} else {\r\n\t\t\t\tPS.teams.unshift(this.createTeam());\r\n\t\t\t}\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'deleteteam': {\r\n\t\t\tconst team = PS.teams.byKey[target];\r\n\t\t\tif (team) PS.teams.delete(team);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'undeleteteam': {\r\n\t\t\tPS.teams.undelete();\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}}\r\n\r\n\t\t// unrecognized command\r\n\t\talert(`Unrecognized command: ${line}`);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tcreateTeam(copyFrom?: Team): Team {\r\n\t\tif (copyFrom) {\r\n\t\t\treturn {\r\n\t\t\t\tname: `Copy of ${copyFrom.name}`,\r\n\t\t\t\tformat: copyFrom.format,\r\n\t\t\t\tfolder: copyFrom.folder,\r\n\t\t\t\tpackedTeam: copyFrom.packedTeam,\r\n\t\t\t\ticonCache: null,\r\n\t\t\t\tkey: '',\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst format = this.curFolder && !this.curFolder.endsWith('/') ? this.curFolder as ID : this.DEFAULT_FORMAT;\r\n\t\t\tconst folder = this.curFolder.endsWith('/') ? this.curFolder.slice(0, -1) : '';\r\n\t\t\treturn {\r\n\t\t\t\tname: `Untitled ${PS.teams.list.length + 1}`,\r\n\t\t\t\tformat,\r\n\t\t\t\tfolder,\r\n\t\t\t\tpackedTeam: '',\r\n\t\t\t\ticonCache: null,\r\n\t\t\t\tkey: '',\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass TeambuilderPanel extends PSRoomPanel<TeambuilderRoom> {\r\n\tselectFolder = (e: MouseEvent) => {\r\n\t\tconst room = this.props.room;\r\n\t\tlet elem = e.target as HTMLElement | null;\r\n\t\tlet folder: string | null = null;\r\n\t\twhile (elem) {\r\n\t\t\tif (elem.className === 'selectFolder') {\r\n\t\t\t\tfolder = elem.getAttribute('data-value') || '';\r\n\t\t\t\tbreak;\r\n\t\t\t} else if (elem.className === 'folderlist') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telem = elem.parentElement;\r\n\t\t}\r\n\t\tif (folder === null) return;\r\n\t\troom.curFolderKeep = folder;\r\n\t\troom.curFolder = folder;\r\n\t\te.preventDefault();\r\n\t\te.stopImmediatePropagation();\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\trenderFolderList() {\r\n\t\tconst room = this.props.room;\r\n\t\t// The folder list isn't actually saved anywhere:\r\n\t\t// it's regenerated anew from the team list every time.\r\n\r\n\t\t// (This is why folders you create will automatically disappear\r\n\t\t// if you leave them without adding anything to them.)\r\n\r\n\t\tconst folderTable: {[folder: string]: 1 | undefined} = {'': 1};\r\n\t\tconst folders: string[] = [];\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tconst folder = team.folder;\r\n\t\t\tif (folder && !(`${folder}/` in folderTable)) {\r\n\t\t\t\tfolders.push(`${folder}/`);\r\n\t\t\t\tfolderTable[`${folder}/`] = 1;\r\n\t\t\t\tif (!('/' in folderTable)) {\r\n\t\t\t\t\tfolders.push('/');\r\n\t\t\t\t\tfolderTable['/'] = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst format = team.format || room.DEFAULT_FORMAT;\r\n\t\t\tif (!(format in folderTable)) {\r\n\t\t\t\tfolders.push(format);\r\n\t\t\t\tfolderTable[format] = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!(room.curFolderKeep in folderTable)) {\r\n\t\t\tfolderTable[room.curFolderKeep] = 1;\r\n\t\t\tfolders.push(room.curFolderKeep);\r\n\t\t}\r\n\t\tif (!(room.curFolder in folderTable)) {\r\n\t\t\tfolderTable[room.curFolder] = 1;\r\n\t\t\tfolders.push(room.curFolder);\r\n\t\t}\r\n\r\n\t\tPSUtils.sortBy(folders, folder => [\r\n\t\t\tfolder.endsWith('/') ? 10 : -parseInt(folder.charAt(3), 10),\r\n\t\t\tfolder,\r\n\t\t]);\r\n\r\n\t\tlet renderedFormatFolders = [\r\n\t\t\t<div class=\"foldersep\"></div>,\r\n\t\t\t<TeamFolder cur={false} value=\"+\">\r\n\t\t\t\t<i class=\"fa fa-plus\"></i><em>(add format folder)</em>\r\n\t\t\t</TeamFolder>,\r\n\t\t];\r\n\r\n\t\tlet renderedFolders: preact.ComponentChild[] = [];\r\n\r\n\t\tlet gen = -1;\r\n\t\tfor (let format of folders) {\r\n\t\t\tconst newGen = format.endsWith('/') ? 0 : parseInt(format.charAt(3), 10);\r\n\t\t\tif (gen !== newGen) {\r\n\t\t\t\tgen = newGen;\r\n\t\t\t\tif (gen === 0) {\r\n\t\t\t\t\trenderedFolders.push(...renderedFormatFolders);\r\n\t\t\t\t\trenderedFormatFolders = [];\r\n\t\t\t\t\trenderedFolders.push(<div class=\"foldersep\"></div>);\r\n\t\t\t\t\trenderedFolders.push(<div class=\"folder\"><h3>Folders</h3></div>);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderedFolders.push(<div class=\"folder\"><h3>Gen {gen}</h3></div>);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst folderOpenIcon = room.curFolder === format ? 'fa-folder-open' : 'fa-folder';\r\n\t\t\tif (gen === 0) {\r\n\t\t\t\trenderedFolders.push(<TeamFolder cur={room.curFolder === format} value={format}>\r\n\t\t\t\t\t<i class={\r\n\t\t\t\t\t\t`fa ${folderOpenIcon}${format === '/' ? '-o' : ''}`\r\n\t\t\t\t\t}></i>\r\n\t\t\t\t\t{format.slice(0, -1) || '(uncategorized)'}\r\n\t\t\t\t</TeamFolder>);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\trenderedFolders.push(<TeamFolder cur={room.curFolder === format} value={format}>\r\n\t\t\t\t<i class={`fa ${folderOpenIcon}-o`}></i>\r\n\t\t\t\t{format.slice(4) || '(uncategorized)'}\r\n\t\t\t</TeamFolder>);\r\n\t\t}\r\n\t\trenderedFolders.push(...renderedFormatFolders);\r\n\r\n\t\treturn <div class=\"folderlist\" onClick={this.selectFolder}>\r\n\t\t\t<div class=\"folderlistbefore\"></div>\r\n\r\n\t\t\t<TeamFolder cur={!room.curFolder} value=\"\">\r\n\t\t\t\t<em>(all)</em>\r\n\t\t\t</TeamFolder>\r\n\t\t\t{renderedFolders}\r\n\t\t\t<div class=\"foldersep\"></div>\r\n\t\t\t<TeamFolder cur={false} value=\"++\">\r\n\t\t\t\t<i class=\"fa fa-plus\"></i><em>(add folder)</em>\r\n\t\t\t</TeamFolder>\r\n\r\n\t\t\t<div class=\"folderlistafter\"></div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tlet teams: (Team | null)[] = PS.teams.list.slice();\r\n\r\n\t\tif (PS.teams.deletedTeams.length) {\r\n\t\t\tconst undeleteIndex = PS.teams.deletedTeams[PS.teams.deletedTeams.length - 1][1];\r\n\t\t\tteams.splice(undeleteIndex, 0, null);\r\n\t\t}\r\n\r\n\t\tlet filterFolder: string | null = null;\r\n\t\tlet filterFormat: string | null = null;\r\n\t\tif (room.curFolder) {\r\n\t\t\tif (room.curFolder.slice(-1) === '/') {\r\n\t\t\t\tfilterFolder = room.curFolder.slice(0, -1);\r\n\t\t\t\tteams = teams.filter(team => !team || team.folder === filterFolder);\r\n\t\t\t} else {\r\n\t\t\t\tfilterFormat = room.curFolder;\r\n\t\t\t\tteams = teams.filter(team => !team || team.format === filterFormat);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<div class=\"folderpane\">\r\n\t\t\t\t{this.renderFolderList()}\r\n\t\t\t</div>\r\n\t\t\t<div class=\"teampane\">\r\n\t\t\t\t{filterFolder ?\r\n\t\t\t\t\t<h2>\r\n\t\t\t\t\t\t<i class=\"fa fa-folder-open\"></i> {filterFolder} {}\r\n\t\t\t\t\t\t<button class=\"button small\" style=\"margin-left:5px\" name=\"renameFolder\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-pencil\"></i> Rename\r\n\t\t\t\t\t\t</button> {}\r\n\t\t\t\t\t\t<button class=\"button small\" style=\"margin-left:5px\" name=\"promptDeleteFolder\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-times\"></i> Remove\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t: filterFolder === '' ?\r\n\t\t\t\t\t<h2><i class=\"fa fa-folder-open-o\"></i> Teams not in any folders</h2>\r\n\t\t\t\t: filterFormat ?\r\n\t\t\t\t\t<h2><i class=\"fa fa-folder-open-o\"></i> {filterFormat}</h2>\r\n\t\t\t\t:\r\n\t\t\t\t\t<h2>All Teams</h2>\r\n\t\t\t\t}\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button name=\"cmd\" value=\"/newteam\" class=\"button big\"><i class=\"fa fa-plus-circle\"></i> New Team</button>\r\n\t\t\t\t</p>\r\n\t\t\t\t<ul class=\"teamlist\">\r\n\t\t\t\t\t{teams.map(team => team ? (\r\n\t\t\t\t\t\t<li key={team.key}>\r\n\t\t\t\t\t\t\t<TeamBox team={team} /> {}\r\n\t\t\t\t\t\t\t<button name=\"cmd\" value={`/deleteteam ${team.key}`}><i class=\"fa fa-trash\"></i> Delete</button>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<li key=\"undelete\">\r\n\t\t\t\t\t\t\t<button name=\"cmd\" value={`/undeleteteam`}><i class=\"fa fa-undo\"></i> Undo delete</button>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</ul>\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button name=\"cmd\" value=\"/newteam bottom\" class=\"button\"><i class=\"fa fa-plus-circle\"></i> New Team</button>\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['teambuilder'] = {\r\n\tModel: TeambuilderRoom,\r\n\tComponent: TeambuilderPanel,\r\n\ttitle: \"Teambuilder\",\r\n};\r\n"],"file":"panel-teambuilder.js"}